// Generated by CoffeeScript 1.7.1
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  window.Magic = (function() {
    function Magic(character, magicSheetInfo, direction, x, y, stage, arena) {
      this.character = character;
      this.magicSheetInfo = magicSheetInfo;
      this.direction = direction;
      this.x = x;
      this.y = y;
      this.stage = stage;
      this.arena = arena;
      this.hit = __bind(this.hit, this);
      this.move = __bind(this.move, this);
      this.id;
      this.magicSheet;
      this.magic;
      this.stage;
      this.arena;
      this.init();
    }

    Magic.prototype.init = function() {
      this.magicSheet = new createjs.SpriteSheet(this.magicSheetInfo);
      this.magic = new createjs.BitmapAnimation(this.magicSheet);
      this.magic.x = this.x;
      return this.magic.y = this.y;
    };

    Magic.prototype.cast = function() {
      console.log('cast magic on ' + this.direction);
      this.magic.addEventListener("tick", this.move);
      this.magic.addEventListener("tick", this.hit);
      this.arena.container.addChild(this.magic);
      return this.magic.gotoAndPlay("cast");
    };

    Magic.prototype.move = function(event) {
      var bound, magic;
      magic = event.target;
      bound = this.arena.getBound();
      if (this.direction === "right") {
        magic.x += 10;
      } else {
        magic.x -= 10;
      }
      if (magic.x > bound['x2'] || magic.x < 0) {
        return this.arena.container.removeChild(magic);
      }
    };

    Magic.prototype.getRect = function() {
      var x1, x2, y1, y2;
      x1 = this.magic.getBounds().x + this.magic.x;
      y1 = this.magic.getBounds().y + this.magic.y;
      x2 = this.magic.getBounds().x + this.magic.x + this.magic.getBounds().width;
      y2 = this.magic.getBounds().y + this.magic.y + this.magic.getBounds().height;
      return {
        "x1": x1,
        "x2": x2,
        "y1": y1,
        "y2": y2
      };
    };

    Magic.prototype.hit = function(event) {
      var magic, player, rect1, rect2, _i, _len, _ref, _results;
      magic = event.target;
      if (magic === null) {
        return;
      }
      rect1 = {
        "x1": magic.getBounds().x + magic.x,
        "y1": magic.getBounds().y + magic.y,
        "x2": magic.getBounds().x + magic.x + magic.getBounds().width,
        "y2": magic.getBounds().y + magic.y + magic.getBounds().height
      };
      _ref = this.arena.getPlayers();
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        player = _ref[_i];
        rect2 = player.getRect();
        if (!((rect2.x2 < rect1.x1) || (rect2.x1 > rect1.x2) || (rect2.y1 > rect1.y2) || (rect2.y2 < rect1.y1))) {
          player.gotHit(this.direction);
          console.log('hit player' + player.id);
          magic.removeAllEventListeners();
          _results.push(this.arena.container.removeChild(magic));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    return Magic;

  })();

}).call(this);
